<!DOCTYPE html>
<!-- saved from url=(0052)https://guides.github.com/introduction/git-handbook/ -->
<html lang="en">
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

      <title>Lab 3 - Interactive Choropleth Map </title>
      <!-- <link rel="icon" type="image/x-icon" href="https://guides.github.com/favicon.ico"> -->

      <meta name="viewport" content="width=device-width,initial-scale=1">

      <link rel="icon" href="brazil.png" >

      <link rel="stylesheet" href="gridism.css">
      <link rel="stylesheet" href="markdown.css">
      <link rel="stylesheet" href="octicons.css">
      <link href="main.css" rel="stylesheet">
      <link href="pygments.css" rel="stylesheet">

      <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
      <link href="prism.css" rel="stylesheet" />

      <script type="text/javascript" async="" src="ga.js"></script><script src="jquery.js" type="text/javascript"></script>
      <script src="snap.svg-min.js" type="text/javascript"></script>
      <script src="application.js" type="text/javascript"></script>

      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-3769691-29']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>

    </head>

    <body style="background-color:#935116">

        <article class="full">
            <div class="article-heading js-article-heading js-geopattern" style="background-color:#935116">
                <div class="wrap">
                  <h1>Incomplete</h1>
                  <!-- <h1>Lab 3 - Interactive Choropleth Map   <i class="fa fa-leaf"></i></h1> -->
                  <p style="color:#FFC300"><b><i class="fa fa-spinner fa-spin"></i>  Due: 11:59 pm, Wednesday, 9/26</b></p>
                </div>
            </div>

            <div class="wrap">
                <div class="toc-wrapper"><ol class="toc js-toc sticky"></ol></div>

                <div class="markdown-body content-body">


                  <p><a id="overview" title="Overview" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Overview</h3>
                  <p><i class="fa fa-spinner fa-spin"></i>  In this lab, we will create an interactive <a href="https://en.wikipedia.org/wiki/Choropleth_map" target="_blank">choropleth map</a> using GeoJSON data.</p>
                    <p><i class="fa fa-spinner fa-spin"></i>  Please read the instructions carefully (including the explanations of each step) and complete the assignment in the <a href="#deliverable">Deliverables</a> section at the bottom. You will need to acquire your own data (a shapefile with attribute values you are intended to map) and create a choropleth map. </p>



                  <p><a id="prep" title="Set Up Basemap" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Set Up Basemap</h3>
                  <ul>
                         <li>Before you start, create a <b>new file folder</b> (e.g., lab3) for this lab.</li>

                          <li>Open your <b>code editor</b> and add the following lines to set up the basemap using the Mapbox light canvas.<br><br>
                          <b>Note you will need to paste <code>your MapBox access token</code> for the <code>accessToken</code> option of L.tileLayer in order to use MapBox tile layers. </b>It is recommended to save your MapBox token to a file/app that you have easy access to as we may use their canvas background a lot in the future.<br>

                               <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Lab 3&lt;/title&gt;

        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet@1.3.4/dist/leaflet.css&quot;
        integrity=&quot;sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==&quot;
        crossorigin=&quot;&quot;/&gt;

        &lt;script src=&quot;https://unpkg.com/leaflet@1.3.4/dist/leaflet.js&quot;
        integrity=&quot;sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==&quot;
        crossorigin=&quot;&quot;&gt;&lt;/script&gt;

    &lt;/head&gt;

    &lt;body&gt;
        &lt;div id=&quot;map&quot; style=&quot;height: 500px&quot;&gt;&lt;/div&gt;

        &lt;script type=&quot;text/javascript&quot;&gt;

          var map = L.map('map', {
              center: [51.48,-0.07],
              zoom: 10
          });

         L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
           attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
           maxZoom: 11,
           minZoom: 5,
           id: 'mapbox.light',
           accessToken: 'your mapbox public access token'
         }).addTo(map);

        &lt;/script&gt;
   &lt;/body&gt;
&lt;/html&gt;
</code></pre></li>
           <li>Then, save the document as <code>map3.html</code> in your lab 3 folder. Please remember to specify the file extension as <b>.html</b> to make it work. Your map should look like:<br></li>

            <iframe src="map/map3.html" width=100% height=520 frameborder=0></iframe><br>
            <p>Yep, I will map London this time! </p>
                       </ul>



                <p><a id="geojson" title="Prepare and Add GeoJSON Layer" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Prepare and Add GeoJSON Layer</h3>
                    <p>In Lab 2, we have introduced how to add markers to your map manually using their geographic coordinates. But you may wish to work with more complex spatial features as in a desktop GIS. So we introduce GeoJSON, which is a format for encoding a variety of geographic data structures (<a href="http://geojson.org" target="_blank">http://geojson.org</a>).</p>
                     <ul>

                        <li style="font-weight:bold;color:red;"> Getting Data: click <a href="https://drive.google.com/file/d/0BzvZaHCgmEmNYWFmc2R4UHNHSzg/view?usp=sharing" target="_blank">here</a> to download the sample shapefile I used in this lab. </li>
                        <li>Extract the zipped data folder to your desired directory.</li>

                            <li>Launch <strong>QGIS Desktop 2.14</strong> (available in both BBH 242 and BBH 252; It is open source and cross-platform so you can <a href="https://drive.google.com/drive/folders/1YEhhr2qYfemLSetO_del9WO55kxJhnLW?usp=sharing" target=_blank>download QGIS here</a> and install it on your own computer). </li>

                            <li>In QGIS, go to <b>Layer (top menu bar) &gt; Add Layer &gt; Add Vector Layer</b> (If you have a newer or older version QGIS, the menu organization may be different). Then browse to the directory where you have extracted the shapefile and select the <b>london_borough.shp</b> file to open it in QGIS. </li>

                            <li>Right-click the layer in the Layers Panel and select <b>Open Attribute Table</b>. The shapefile contains three fields in their attribute table: <b>NAME, pop_den (population density in <i>people per hectare</i> 2011), and per_indian (percent Indian population 2011)</b>. </li>

                              <li>Although we will be mapping the data on the web eventually, it is helpful to explore the data in QGIS to help determine the details for rendering the data on the web. Right-click the layer again and select <b>Properties</b>, then choose the <b>Style</b> tab (see image below).
                                <ul>
                                <li>Use <b>Graduated</b> Symbol to render the data (this option is used when making choropleth maps).</li>
                                <li>For Column, choose the attribute you are intended to map, <code>pop_den</code> in my example.</li>
                                <li>Under Classes, you could pick the mode of data classification (I used Natural Breaks) and number of classes (I used 5). Wondering what the different modes mean? Check out <a href="http://pro.arcgis.com/en/pro-app/help/mapping/layer-properties/data-classification-methods.htm" target="_blank">this link</a>.</li>
                                  <center><img src="img/class.png" width=100% align="middle" ></center>
                                <li>Click OK to apply the selected style. And you should see an example of the london boroughs map rendered as a choropleth map.</li>
                              <center><img src="img/choropleth.png" width=100% align="middle" ></center>
                            <li>Pay attention to the legend of the map, jot down the approximate break numbers, we will these values later when adding the data to the web. For example, I take notes of the integer values of <i>32, 53, 87, 139</i> for later use.</li> </ul>
                              </li>


                              <br>
                              <li>To maximize the rendering speed, there are two imporant steps we should always perform in QGIS before exporting a shapefile to GeoJSON: (1) <span style="color:#C0392B; font-weight:bold">simplify geometry</span>; and (2) <span style="color:#C0392B  ; font-weight:bold">delete unwanted fields in the attribute table</span>. I will show you how to do so in the following steps: <br>
                                <ul>
                                    <li> <span style="color:#C0392B; font-weight:bold">Simplify geometry</span>
                                      <br>In QGIS, go to <b>Vector &gt; Geometry Tools &gt; Simplify Geometries</b>, use london_borough as Input (see image below).
                                      <br>For the <b> Simplify tolerance</b>, the unit is the same as the map unit (meter in this case). You could find out the map unit of your own layer by selecting <b>Project > Project Properties</b>, then the <b>General</b> tab, under <b>Coordinate display</b> to choose Display coordinates using Map units (XXX). Basically, vertices are removed if the distance with the tentative simplified line is smaller than the tolerance. Therefore, higher tolerance values would generate simpler features (smaller file size) but also lose some details. I will use <b>2</b> here. For your own map, you may want to consider the map scale and experiment a few options to determine the "best" tolerance value.
                                      <center><img src="img/simplify2.png" width=60% align="middle" ></center>
                                      <br>Click <b>OK</b> to run. Once the process is complete, you will see a dialog window telling you how many vertices have been eliminated.
                                      <br>Note your layer may be in editing mode with many red crosses shown at each vertex. You could get rid of them by clicking on the <b>Toggle Edit</b> button <img src="img/button.png" align="bottom">, and click <b>Save</b> in the pop-up dialog to confirm the changes we just made. </li>

                                    <li><span style="color:#C0392B  ; font-weight:bold">Delete unwanted fields</span>
                                    <br>You could delete fields of a layer with tools in its attribute table (right-click the layer in the Layes Panel and select <b>Open Attribute Table</b>. <b>Turn on editing mode</b> within the table using the same pencil button. Then click the <b>Delete field</b> button <img src="img/button2.png" align="bottom"> and select the fields you want to delete and click OK. I want to map population density here so I will delete the per_indian field.
                                    <br>Turn off the editing mode and click <b>Save</b> to confirm your changes. Close the attribute table.</li>
                                </ul>

                        </li>


                        <li>Now we are ready to export the layer. Right-click the layer in the Layes Panel and select <b>Save As...</b>. In the dialog window (see image below), set Format to <b>GeoJSON</b>, click Browse to save output file to your lab data folder (any name you like), and set the CRS to <b>EPSG:4326 - WGS 84</b> (see image below). <br>
                            <center><img src="img/qgis.png" width=100% ></center></li>
                            <li>Click OK to save the GeoJSON file. We will use QGIS to help classify the data values in the Add Colors step but you could exit QGIS if you are intended to work on that later.</li>
                        <li>Use <b>Atom</b> to open the GeoJSON file (similar to open an HTML document). Place the following at the very beginning of the GeoJSON document (see image below):
                            <pre><code class="language-javascript">var data = </code></pre>
                          <center>  <img src="img/geojson.png" width=100% ></center></li>
                         <li>Save the changed GeoJSON as <code><b>data.js</b></code> to your <b>lab working folder (where your html file is saved)</b>. Note the file extension is <code>.js</code>.
                             <br>Here is a copy of the <a href="map/data.js" target="_blank">(data.js)</a> file I created.</li>
                        <li>Return to your HTML document. In the <code>head</code> section, include the following line so that we can use <code>data.js</code> for mapping:
                            <pre><code class="language-javascript">&lt;script type="text/javascript" src=<span style="color:#cc6600">"data.js"</span>&gt;&lt;/script&gt;</code></pre></li>
                        <li>Then, in the <code>script</code> section (inside <code>body</code>), include the following line to add the data (AFTER adding the tile layer).
                            <pre><code class="language-javascript">L.geoJson(data).addTo(map);</code></pre>
                        The GeoJSON data layer is now added to the map! Take a look at the <a href="https://raw.githubusercontent.com/neiugis/lab3/gh-pages/map/geojsondata.html" target="_blank">sample code</a> if needed.
                      <iframe src="map/geojsondata.html" height=570 width=100% frameborder=0></iframe></li>
                    </ul>



                  <p><a id="color" title="Add Colors" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Add Colors</h3>
                     <ul>
                        <li>Now, we will color the London Boroughs according to their population density values, e.g., darker color for higher density and lighter color for lower density. Recall the population density data will come from the <code>pop_den</code> attribute/property of the data. </li>
                        <li>For choosing colors, I recommend <a href="http://colorbrewer2.org/" target="_blank">ColorBrewer</a> by Dr. Cynthia Brewer, where you can pick a color scheme and get the correponing HTML color codes directly. I will use the 5-class Purples here:<br>
                            <img src="img/green.png"></li>

                        <li>Once we have the color codes, we need to create a javascript function that returns a color based on attribute values, i.e., <code>pop_den</code>. Place the following lines to define the function BEFORE adding the GeoJSON data (<b>ABOVE</b> the line of <code>L.geoJson</code>):
                            <pre><code class="language-javascript">function getColor(value) {
    return value > 139 ? '#54278f':
           value > 87  ? '#756bb1':
           value > 53  ? '#9e9ac8':
           value > 32  ? '#cbc9e2':
                         '#f2f0f7';
}
</code></pre>
              In the above lines, the numbers (<i>e.g., 32, 53, 87, 139</i>) are the <b>break values</b> used to classify the population density (people/hectare) of the London Boroughs. Recall that I used <code>Natural Breaks</code> as the classification mode and used <code>5 classes</code>.
              <br><br>For your own data, you may use QGIS to help determine the break values.
              <br><br>
              Let's try to take a close look at the fuction: if the value (population density) is <b>greater than 139</b> people/hectare, the darkest purple (<code>#54278f</code>) will be used. If the value is <b>less than 139 but greater than 87</b>, use the second dark purple (<code>#756bb1</code>), and so forth. The <b>question mark <code>?</code></b> and <b>colon <code>:</code></b> are used together to create a conditional statement (We will talk about this on Monday).
              <br><br>It is okay if you cannot fully understand this. If you use your own data, you will just need to replace the <b>break values</b> and <b>colors</b>. You can, of course, add or remove classes. Please follow the syntax carefully.</li>

              <li>Note: defining the functions won't add/change anything to the map until the functions are used for adding the layers through Leaflet functions.</li>

                        <li>Following the <code>getColor</code> function, we define another function called <code>style</code> for the GeoJSON layer so that its fill the boroughs with colors based on the population density attribute:
<pre><code class="language-javascript">function style(feature){
    return {
        fillColor: getColor(feature.properties.pop_den),   // pop_den is the field name for the population density data
        weight: 2,
        opacity: 1,
        color: 'gray',
        fillOpacity: 0.9
    };
}</code></pre>Note the <span style="color:#990099">pop_den</span> is the field name for the population density values. You will need to use the corresponding field name when mapping your own data.<br><br>For the function attributes, you may be able to tell what they do by their names, e.g., <code>fillColor</code> is to define the fillcolor of the features using the <code>getColor</code> function, <code>weight</code> is to define the weight of the boundary lines, etc. You may try to customize the appearance by adjusting the corresponding values.</li>

                        <li>To use the functions we just defined, we need to <b>MODIFY</b> the line of <code>L.geoJson</code> to:
                            <pre><code class="language-javascript">L.geoJson(data, {style:style}).addTo(map);</code></pre>Please make sure the two functions are defined above <code>L.geoJson</code>.<br><br>
                        Now we have a map with colors (<a href="https://raw.githubusercontent.com/neiugis/lab3/gh-pages/map/color.html" target="_blank">sample code</a>) !
                        <iframe src="map/color.html" width=95% height=570 frameborder=0></iframe></li>
                    </ul>




                    <p><a id="legend" title="Add Legend" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Add Legend</h3>

                    <ul>
                          <li>Next, we will add legend to the map. In the <code>head</code> section of your html document, place the following lines to define the appearance of the legend (see the comment lines in red for explanations):
                        <pre><code class="language-css">&lt;style&gt;
  /* Optional: adjust the values below to change the appearance of the legend */
  .legend {
      padding: 6px 8px;
      line-height: 18px;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border-radius: 5px;
  }

   /* Optional: adjust the values below to change the appearance of the legend color boxes */
   .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      opacity: 0.7;
  }
&lt;/style&gt;</code>
</pre></li>
                    <li>Next, in the <code>script</code> section of <code>body</code>, add the following lines below <code>L.geoJson</code> to define how the legend will be created in your map (see the comment lines for explanation):
                        <pre><code class="language-javascript">var legend = L.control({position: 'bottomright'}); // Try the other three corners if you like.

legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'legend'),
        grades = [0, 32, 53, 87, 139]; // The break values to define the intervals of population, note we begin from 0 here

    div.innerHTML = '&lt;b&gt;Population Density &lt;br&gt; 2011 &lt;br&gt;&lt;/b&gt;'; // The legend title, in this case it's Population Density 2011

    // Loop through our the classes and generate a label with a colored square for each interval.
    // If you are creating a similar choropleth map, you do not need to change lines below.
    for (var i = 0; i &lt; grades.length; i++) {
        div.innerHTML +=
        '&lt;i style=&quot;background:' + getColor(grades[i] + 1) + '&quot;&gt;&lt;/i&gt;' +
        grades[i] + (grades[i + 1] ? '&amp;ndash;' + grades[i + 1] + '&lt;br&gt;' : '+');
    }

    return div;
};

legend.addTo(map);</code></pre>
                        The above functions for defining the legend may be too much for you to understand. But you can simply replace some small portions according to the comment lines when you create your own map.
                        <br><br>
                        The legend will be created at the bottom right corner of your map with the defined styles and content (<a href="https://raw.githubusercontent.com/neiugis/lab3/gh-pages/map/map3.html" target="_blank">sample code</a>):
                          <iframe src="map/map3.html" width=95% height=570 frameborder=0></iframe>
                    </li>
                </ul>
                <br>



                  <p><a id="deliverable" title="Deliverables" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Deliverables</h3>
                    <ul><li>Find your own vector layer (polygons with attributes) and create an interactive choropleth map.
                        </li>
                        <li>Your final map will be graded based on its overall accuracy (should meet all the requirements above) and cartographic layout/design.</li>
                        <li>Host your web page (Make sure to rename the html file as <code>index.html</code> and UPLOAD the data file (<code>data.js</code>) to the repository!!!) and submit the url through D2L. </li></ul>

            <br><br>
            </div>
            </div>
        </article>

          <footer>
            <div class="wrap">

              <p>Copyright &copy; Ting Liu 2018</p>
            <div>Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>
            </div>
          </footer>

            <script src="prism.js"></script>

     </body>
</html>
